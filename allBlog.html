<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="Access-Control-Allow-Origin" content="*" /><!-- å…è®¸è·¨åŸŸè¯·æ±‚ -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/allBlog.css">
    <title>åšæ–‡æµè§ˆ</title>

<body>
<div class="container-fluid">
    <div class="header">
        <nav class="navbar navbar-expand-md navbar-dark">
            <a class="navbar-brand" href="#">
                <img src="images/logo.png" alt="logo" style="width:100px;height: 68.5px">
            </a>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="collapsibleNavbar">
                <ul class="navbar-nav ">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">é¦–é¡µ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="allNotice.html">å…¬å‘Š</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">åšå®¢</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">ä½œå“å±•ç¤º</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">åŠ¨æ€</a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>


    <!-- ä¸­éƒ¨åšå®¢é¡µé¢ -->
    <div class="blog">
        <div class="row" id="blog-body">

        </div>
        <!-- åˆ†é¡µ -->
        <nav aria-label="Page navigation" class="navigation" id="navigation">
            <ul class="pagination col-md-4">

            </ul>
        </nav>
    </div>
</div>



<script src="assent/jquery/dist/jquery.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script>
    var pageData = {
        tempPage: 1,//å½“å‰é¡µ
        pageSize: 12, //ä¸€é¡µæ˜¾ç¤ºçš„æ•°é‡
        total: 0,//æ€»æ•°æ®é‡
        totalPage:0//é¡µæ•°
    };

    $(function () {
        uploadData();
    });



    function uploadData() {
        $.ajax({
            url: API.getAPI(API.getAllBlog),
            type: "get",
            data: {
//                        page:pageData.tempPage,//å½“å‰é¡µé¢æ•°
//                        page_size:pageData.pageSize	//æ˜¾ç¤ºé•¿åº¦
            },
            dataType: 'json', //æœåŠ¡å™¨è¿”å›jsonæ ¼å¼æ•°æ®
            timeout:10000,//è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º10ç§’ï¼›
            async:false,
            beforeSend:function(){

            },
            success: function(result) {
                if (result.status == 1) {
                    console.log(result);

                    var pageLength = getJsonLength(result);
                    pageData.total = pageLength;
                    //é¡µæ•°
                    pageData.totalPage = Math.ceil(pageData.total / pageData.pageSize);//é¡µæ•°

                    getAllBlog(result,pageData.tempPage);//æ¸²æŸ“blog

                } else {
                    console.log(result.msg);
                    alert("è¿ä¸ä¸ŠæœåŠ¡å™¨å•Šå˜¤å˜¤å˜¤çš„ğŸ˜­");
                }
            },
            error: function(result) {
                alert(result.status);
            }
        });
        setBlogAnimation();//åŠ¨ç”»æ•ˆæœå•¥çš„
        updatePagination();//æ¸²æŸ“åˆ†é¡µå™¨
        console.log("åšæ–‡æ•°é‡ä¸º" + pageData.total);

    }
    function enitblog(id) {
        window.location.href='blog.html?id='+id;
    }
    /**
     * æ¸²æŸ“blogæ•°æ®
     */
    function getAllBlog(result) {
        $("#blog-body").empty();
        if(pageData.total-(pageData.tempPage-1)*12>0) {
            for (var j =(pageData.tempPage-1)*12 ; j < pageData.tempPage*12; j++) {
                $("#blog-body").append('<div class="col-md-4 col-sm-4 col-6 blog-item">\n' +
                    '<div class="blog-item-container" onclick="enitblog(\''+result.data[j].id+'\')">\n' +
                    '<div class="blog-item-img">\n' +
                    '<img src="' + API.picfix + result.data[j].cover + '">\n' +
                    '</div>\n' +
                    '<div class="blog-item-text">\n' +
                    '<h5>' + '<b>' + result.data[j].title + '</b>' + '</h5>\n' +
                    '<br />\n' +
                    '<p>' + result.data[j].brief +
                    '</p>\n' +
                    '</div>\n' +
                    '</div>\n' +
                    '</div>'
                );
            }
        }
    }
    /**
     * åšæ–‡åŠ¨ç”»ä»£ç 
     */
    function setBlogAnimation() {
        // æ¸²æŸ“å›¾ç‰‡å“åº”å¼å®½åº¦
        var screenWidth = window.screen.availWidth;
        var imgLHeight = 0.3 * screenWidth;
        var imgSHeight = 0.2 * screenWidth;
        if (screenWidth < 500 ){
            $(".blog-item").css("height", imgSHeight);
            $(".blog").css("width",'100%');
        } else {
            $(".blog-item").css("height", imgLHeight);
            $(".blog").css("width",'80%');
        }

        //åŠ¨ç”»æ•ˆæœ
        $(".blog-item-container").each(function() {
            $(this).hover(function() {
                $(this).children(".blog-item-text").fadeIn();
            }, function() {
                $(this).children(".blog-item-text").fadeOut();
            });
        });
    }

    /**
     * æ¸²æŸ“åˆ†é¡µå™¨
     */
    function updatePagination() {
        if(pageData.pageSize >= pageData.total){
            console("æ•°æ®åªæœ‰1é¡µ");
            $(".pagination").hide();
        } else {
            console.log("æ•°æ®é‡>12");
            $(".pagination").show();



            $(".pagination").empty();
            if (pageData.tempPage != 1){
                $(".pagination").append('<li class="page-item">' +
                    '<a class="page-link" href="javascript:switchPage(-1)" aria-label="Previous"\n>' +
                    '<span aria-hidden="true">&laquo;</span>\n' +
                    '<span class="sr-only">Previous</span>\n' +
                    '</a>\n' +
                    '</li>'
                );
            }
            for (var i = 0; i < pageData.totalPage; i++) {
                var active="";
                if ((i + 1) == pageData.tempPage) {
                    active = "active";
                }
                $(".pagination").append("<li class=\"page-item "+active+"\"><a class=\"page-link\" href=\"javascript:switchPage("+(i+1)+")\">"+(i+1)+"</a></li>");
            }
            if (pageData.tempPage != pageData.totalPage){
                $(".pagination").append('<li class=\"page-item\">\n' +
                    '<a class=\"page-link\" href=\"javascript:switchPage(-2)\" aria-label=\"Next\">\n' +
                    '<span aria-hidden=\"true\">&raquo;</span>\n' +
                    '<span class=\"sr-only\">Next</span>\n' +
                    '</a>\n' +
                    '</li>'
                );
            }
        }
    }
    //ç¿»é¡µ
    function switchPage(page) {
        if (page == -1){//ä¸Šä¸€é¡µ
            if (pageData.tempPage > 1){
                pageData.tempPage--;
            }
        } else if (page == -2){//ä¸‹ä¸€é¡µ
            if (Math.ceil(pageData.total / pageData.pageSize) > pageData.tempPage){
                pageData.tempPage++;
            }
        } else {
            pageData.tempPage = page;
        }
        uploadData();
    }

    //è·å–jsonæ•°æ®çš„é•¿åº¦
    function getJsonLength(result){
        var jsonLength = 0;
        for(var i = 0;i < result.data.length;i++){
            jsonLength++;
        }
        return jsonLength;
    }
</script>
</body>
</html>
